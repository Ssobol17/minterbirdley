<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Birdley NFTies</title>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        
    <!-- favicon -->
    <link
      rel="apple-touch-icon"
      sizes="180x180"
      href="images/x-icon/apple-touch-icon.png"
    />
    <link
      rel="icon"
      type="image/png"
      
      sizes="32x32"
      href="images/x-icon/favicon-32x32.png"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="16x16"
      href="images/x-icon/favicon-16x16.png"
    />
    <link rel="manifest" href="images/x-icon/site.webmanifest" />
    <link rel="stylesheet" href="css/three-dots.min.css" />
    <link rel="stylesheet" href="css/splide.min.css" />
    <link rel="stylesheet" href="css/style.css" />

    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.4.0/gsap.min.js"></script>
        <style>
        html, body {
            height: 100%;
          }
          body {
            margin: 0;
          }
          
          #canvas {
            width: 100%;
            height: 50%;
          }
          </style>

  </head>
  <body>
    <header>
      <div class="container">
        <div class="logo">
          <a href="/">
            <img src="images/x-icon/favicon-32x32.png" alt="logo" />
          </a>
        </div>
        <div class="menu">
          <a
            href="https://discord.gg/A9CnsVzzkZ"
            target="_blank"
            rel="noopener noreferrer"
          >
            <img src="images/header/discord.webp" alt="Discord" />
          </a>
          <a
            href="https://twitter.com/codeSTACKr"
            target="_blank"
            rel="noopener noreferrer"
          >
            <img src="images/header/twitter.webp" alt="Twitter" />
          </a>
          <a
            href="https://opensea.io/collection/codecats"
            target="_blank"
            rel="noopener noreferrer"
          >
            <img src="images/header/opensea.webp" alt="Opensea" />
          </a>
          <button class="wallet-btn btn" id="connectWallet">
            <span>Connect Wallet</span>
          </button>
        </div>
      </div>
    </header>

    <section class="container not-connected">
      <div>
        <h2 id="welcomeH2">Connect to MetaMask to Get Started</h2>
        <h1 id="welcomeH1">Welcome to Birdley's NFTie Adventure</h1>
        <p id="welcomeP">
          Join Birdley on his random adventures and his constant new outfits... Also keep an eye out for his new P.I.C 
        </p>
      </div>
    </section>

    <section class="container">
      <div class="countdown card">
        <div id="countdown">
          <ul class="count-down" data-date="">
            <li class="clock-item">
              <span class="count-number days">20</span>
              <p class="count-text">Days</p>
            </li>

            <li class="clock-item">
              <span class="count-number hours">20</span>
              <p class="count-text">Hour</p>
            </li>

            <li class="clock-item">
              <span class="count-number minutes">20</span>
              <p class="count-text">Min</p>
            </li>

            <li class="clock-item">
              <span class="count-number seconds">20</span>
              <p class="count-text">Sec</p>
            </li>
          </ul>
          <h2 id="subHeading">Pre-Sale Countdown</h2>
        </div>
        <h1 id="mainHeading">NFT Drop Coming Soon!!</h1>
        <p id="mainText">
          A new batch of "Birdley's and Friends" will be available very soon!
        </p>
        <a
          id="actionButton"
          href="https://discord.gg/A9CnsVzzkZ"
          target="_blank"
          rel="noopener noreferrer"
          class="hero-btn btn"
          ><span>Join the Catmmunity</span>
        </a>
        <div id="mintContainer" class="mint-container hidden">
          <div class="info-container">
            <div>
              <h3>Supply</h3>
              <p id="totalSupply">100</p>
            </div>
            <div>
              <h3>Price Per Mint</h3>
              <p id="pricePerMint">1 ETH</p>
            </div>
            <div>
              <h3>Max</h3>
              <p id="maxPerMint">5 per wallet</p>
            </div>
          </div>
          <div class="mint-qty">
            <span>
              <button class="input-number-decrement btn" id="mintDecrement">â€“</button>
              <input
                id="mintInput"
                class="input-number btn"
                type="number"
                value="1"
                min="1"
                max="5"
              />
              <button class="input-number-increment btn" id="mintIncrement">+</button>
            </span>
            <button id="setQtyMax" class="btn">SET MAX</button>
          </div>
          <div class="total-price-container">
            <h3>Total</h3>
            <p id="totalPrice">.001 ETH</p>
          </div>
          <button id="mintButton" class="hero-btn btn mint-btn">Mint</button>
        </div>
      </div>
      <div class="minted-container card show-card hidden">
        <h1>ðŸŽ‰</h1>
        <h2>Minted!</h2>
        <p>Here's your trasaction link:</p>
        <a id="mintedTxnBtn" href="" target="_blank" rel="noopener noreferrer">
          <button class="hero-btn btn">View Transaction</button>
        </a>
        <p>View it in the collection:</p>
        <a
          id="mintedLinkBtn"
          href="https://testnets.opensea.io/collection/teststackr-collection"
          target="_blank"
          rel="noopener noreferrer"
        >
          <button class="hero-btn btn">View Collection</button>
        </a>
      </div>
    </section>
    <canvas id="canvas"></canvas>

    <div id="spinner" class="dot-spin"></div>

    <div class="splide">
      <div class="splide__track">
        <ul class="splide__list">
          <li class="splide__slide">
            <img src="images/slider/0.png" />
          </li>
          <li class="splide__slide">
            <img src="images/slider/1.png" />
          </li>
          <li class="splide__slide">
            <img src="images/slider/2.png" />
          </li>
          <li class="splide__slide">
            <img src="images/slider/3.png" />
          </li>
          <li class="splide__slide">
            <img src="images/slider/4.png" />
          </li>
          <li class="splide__slide">
            <img src="images/slider/5.png" />
          </li>
          <li class="splide__slide">
            <img src="images/slider/6.png" />
          </li>
          <li class="splide__slide">
            <img src="images/slider/7.png" />
          </li>
          <li class="splide__slide">
            <img src="images/slider/8.png" />
          </li>
        </ul>
      </div>
    </div>

    <script src="js/metamask-onboarding.bundle.js"></script>
    <script src="js/web3.min.js"></script>
    <script src="js/splide.min.js"></script>
    <script src="js/constants.js"></script>
    <script src="js/countdown.js"></script>
    <script src="js/app.js"></script>
    <script>
      console.clear()
          console.log('lsakdfalskjdflnksd')
          //adjust sprite sheet size, location and rows
          const config = {
            src: './130Birdley.png',
            rows: 9,
            cols: 9
          }
          
          // UTILS
          
          const randomRange = (min, max) => min + Math.random() * (max - min)
          
          const randomIndex = (array) => randomRange(0, array.length) | 0
          
          const removeFromArray = (array, i) => array.splice(i, 1)[0]
          
          const removeItemFromArray = (array, item) => removeFromArray(array, array.indexOf(item))
          
          const removeRandomFromArray = (array) => removeFromArray(array, randomIndex(array))
          
          const getRandomFromArray = (array) => (
            array[randomIndex(array) | 0]
          )
          
          // TWEEN FACTORIES
          
          const resetPeep = ({ stage, peep }) => {
            const direction = Math.random() > 0.5 ? 1 : -1
            // using an ease function to skew random to lower values to help hide that peeps have no legs
            const offsetY = 100 - 250 * gsap.parseEase('power2.in')(Math.random())
            const startY = stage.height - peep.height + offsetY
            let startX
            let endX
            
            if (direction === 1) {
              startX = -peep.width
              endX = stage.width
              peep.scaleX = 1
            } else {
              startX = stage.width + peep.width
              endX = 0
              peep.scaleX = -1
            }
            
            peep.x = startX
            peep.y = startY
            peep.anchorY = startY
            
            return {
              startX,
              startY,
              endX
            }
          }
          
          const normalWalk = ({ peep, props }) => {
            const {
              startX,
              startY,
              endX
            } = props
          
            const xDuration = 10
            const yDuration = 0.25
            
            const tl = gsap.timeline()
            tl.timeScale(randomRange(0.5, 1.5))
            tl.to(peep, {
              duration: xDuration,
              x: endX,
              ease: 'none'
            }, 0)
            tl.to(peep, {
              duration: yDuration,
              repeat: xDuration / yDuration,
              yoyo: true,
              y: startY - 10
            }, 0)
              
            return tl
          }
          
          const walks = [
            normalWalk,
          ]
          
          // CLASSES
          
          class Peep {
            constructor({
              image,
              rect,
            }) {
              this.image = image
              this.setRect(rect)
              
              this.x = 0
              this.y = 0
              this.anchorY = 0
              this.scaleX = 1
              this.walk = null
            }
            
            setRect (rect) {
              this.rect = rect
              this.width = rect[2]
              this.height = rect[3]
              
              this.drawArgs = [
                this.image,
                ...rect,
                0, 0, this.width, this.height
              ]  
            }
            
            render (ctx) {
              ctx.save()
              ctx.translate(this.x, this.y)
              ctx.scale(this.scaleX, 1)
              ctx.drawImage(...this.drawArgs)
              ctx.restore()
            }
          }
          
          // MAIN
          
          const img = document.createElement('img')
          img.onload = init
          img.src = config.src
          
          const canvas = document.querySelector('#canvas')
          const ctx = canvas.getContext('2d')
          
          const stage = {
            width: 0,
            height: 0,
          }
          
          const allPeeps = []
          const availablePeeps = []
          const crowd = []
          
          function init () {  
            createPeeps()
            
            // resize also (re)populates the stage
            resize()
          
            gsap.ticker.add(render)
            window.addEventListener('resize', resize)
          }
          
          function createPeeps () {
            const {
              rows,
              cols
            } = config
            const {
              naturalWidth: width,
              naturalHeight: height
            } = img
            const total = rows * cols
            const rectWidth = width / rows
            const rectHeight = height / cols
            
            for (let i = 0; i < total; i++) {
              allPeeps.push(new Peep({
                image: img,
                rect: [
                  (i % rows) * rectWidth,
                  (i / rows | 0) * rectHeight,
                  rectWidth,
                  rectHeight,
                ]
              }))
            }  
          }
          
          function resize () {
            stage.width = canvas.clientWidth
            stage.height = canvas.clientHeight
            canvas.width = stage.width * devicePixelRatio
            canvas.height = stage.height * devicePixelRatio
            
            crowd.forEach((peep) => {
              peep.walk.kill()
            })
            
            crowd.length = 0
            availablePeeps.length = 0
            availablePeeps.push(...allPeeps)
            
            initCrowd()
          }
          
          function initCrowd () {
            while (availablePeeps.length) {
              // setting random tween progress spreads the peeps out
              addPeepToCrowd().walk.progress(Math.random())
            }
          }
          
          function addPeepToCrowd () {
            const peep = removeRandomFromArray(availablePeeps)
            const walk = getRandomFromArray(walks)({
              peep,
              props: resetPeep({
                peep,
                stage,
              })
            }).eventCallback('onComplete', () => {
              removePeepFromCrowd(peep)
              addPeepToCrowd()
            })
            
            peep.walk = walk
            
            crowd.push(peep)
            crowd.sort((a, b) => a.anchorY - b.anchorY)
            
            return peep
          }
          
          function removePeepFromCrowd (peep) {
            removeItemFromArray(crowd, peep)
            availablePeeps.push(peep)
          }
          
          function render () {
            canvas.width = canvas.width
            ctx.save()
            ctx.scale(devicePixelRatio, devicePixelRatio)
            
            crowd.forEach((peep) => {
              peep.render(ctx)
            })
            
            ctx.restore()
          }
  </script>
  </body>
</html>
